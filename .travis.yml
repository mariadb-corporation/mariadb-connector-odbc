sudo: true
language: c
version: ~> 1.0

cache:
  apt: true
  ccache: true
  directories:
    - $HOME/docker

env:
  global: CLEAR_TEXT=0 DB=testo  local=0

import: mariadb-corporation/connector-test-machine:common-build.yml@master

jobs:
  fast_finish: true
  allow_failures:
    - os: osx
    - os: linux
      arch: s390x
      dist: focal
    - env: srv=maxscale MAXSCALE_TEST_DISABLE=true
    - env: srv=xpand
  include:
    - stage: Language
      os: osx
      compiler: clang
      before_script:
        - brew install openssl
        - brew install libiodbc
    - stage: Language
      os: linux
      arch: s390x
      dist: focal
      env: srv=mariadb v=10.11 local=1

script:
  - ./.travis/script.sh
